# ODCRæœ¬åœ°ç®¡ç†å·¥å…· - è¯¦ç»†ä½¿ç”¨æŒ‡å—

## æ¦‚è¿°
æœ¬åœ°Pythonè„šæœ¬å®ç°ODCRç®¡ç†åŠŸèƒ½ï¼Œæ”¯æŒåˆ›å»ºæ–°ODCRå’Œæ‰©å®¹ç°æœ‰ODCRï¼Œå†…ç½®æ™ºèƒ½æ‹†åˆ†è´­ä¹°é€»è¾‘å’Œå®æ—¶è¿›åº¦æ˜¾ç¤ºã€‚

## å®‰è£…é…ç½®

### 1. å®‰è£…Pythonä¾èµ–
```bash
pip install -r requirements.txt
```

### 2. é…ç½®AWSå‡­è¯
å¯é€šè¿‡ä»¥ä¸‹æ–¹å¼ä¹‹ä¸€é…ç½®ï¼š

**æ–¹å¼1: AWS CLI**
```bash
aws configure
```

**æ–¹å¼2: ç¯å¢ƒå˜é‡**
```bash
export AWS_ACCESS_KEY_ID=your_access_key
export AWS_SECRET_ACCESS_KEY=your_secret_key
export AWS_DEFAULT_REGION=us-west-2
```

**æ–¹å¼3: IAMè§’è‰²** (åœ¨EC2å®ä¾‹ä¸Šè¿è¡Œæ—¶)
æ— éœ€é¢å¤–é…ç½®ï¼Œè‡ªåŠ¨ä½¿ç”¨å®ä¾‹è§’è‰²

### 3. æ‰€éœ€AWSæƒé™
```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "ec2:CreateCapacityReservation",
        "ec2:ModifyCapacityReservation", 
        "ec2:DescribeCapacityReservations"
      ],
      "Resource": "*"
    }
  ]
}
```

## ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬ç”¨æ³•
```bash
python odcr_manager.py create --instance-type INSTANCE_TYPE --availability-zone AZ --count COUNT
```

### å®Œæ•´å‚æ•°ç¤ºä¾‹
```bash
python odcr_manager.py create \
  --instance-type r7i.metal-24xl \
  --availability-zone us-west-2a \
  --count 10 \
  --preference open \
  --timeout 60 \
  --region us-west-2
```

### å¸¸ç”¨åœºæ™¯

**1. å¤§æ‰¹é‡å®ä¾‹é¢„ç•™**
```bash
python odcr_manager.py create --instance-type m5.large --availability-zone us-west-2a --count 50
```

**2. é«˜ç«¯å®ä¾‹ç±»å‹**
```bash
python odcr_manager.py create --instance-type r7i.metal-24xl --availability-zone us-west-2a --count 5
```

**3. çŸ­æ—¶é—´ä»»åŠ¡**
```bash
python odcr_manager.py create --instance-type t3.medium --availability-zone us-west-2a --count 20 --timeout 30
```

## æ‰§è¡Œç¤ºä¾‹

### æˆåŠŸåœºæ™¯ (å®¹é‡å……è¶³)
```
ğŸ¯ ç›®æ ‡: åˆ›å»º 8 å° t3.micro å®ä¾‹åœ¨ us-west-2a
â° è¶…æ—¶è®¾ç½®: 60 åˆ†é’Ÿ
============================================================

ğŸ”„ ç¬¬1æ¬¡å°è¯•: åˆ›å»ºæ–°ODCR (8å°)
ğŸ“Š è¿›åº¦: 0/8 (0.0%) | ODCRæ•°é‡: 0 | è¿è¡Œæ—¶é—´: 0:00:00
âœ… æ–°ODCRåˆ›å»ºæˆåŠŸ! cr-abc123 (8 å°)
ğŸ“Š è¿›åº¦: 8/8 (100.0%) | ODCRæ•°é‡: 1 | è¿è¡Œæ—¶é—´: 0:00:01
============================================================
ğŸ‰ ä»»åŠ¡å®Œæˆ! ä½¿ç”¨ 1 ä¸ªODCRï¼Œæ€»è®¡ 8 å°å®ä¾‹
ğŸ“Š æ€»å°è¯•æ¬¡æ•°: 1
```

### æ‹†åˆ†è´­ä¹°åœºæ™¯ (å®¹é‡ä¸è¶³)
```
ğŸ¯ ç›®æ ‡: åˆ›å»º 10 å° r7i.metal-24xl å®ä¾‹åœ¨ us-west-2a
â° è¶…æ—¶è®¾ç½®: 60 åˆ†é’Ÿ
============================================================

ğŸ”„ ç¬¬1æ¬¡å°è¯•: åˆ›å»ºæ–°ODCR (10å°)
ğŸ“Š è¿›åº¦: 0/10 (0.0%) | ODCRæ•°é‡: 0 | è¿è¡Œæ—¶é—´: 0:00:00
âš ï¸  å®¹é‡ä¸è¶³ï¼Œé™çº§åˆ° 5 å°é‡è¯•

ğŸ”„ ç¬¬2æ¬¡å°è¯•: åˆ›å»ºæ–°ODCR (5å°)
ğŸ“Š è¿›åº¦: 0/10 (0.0%) | ODCRæ•°é‡: 0 | è¿è¡Œæ—¶é—´: 0:00:05
âš ï¸  å®¹é‡ä¸è¶³ï¼Œé™çº§åˆ° 2 å°é‡è¯•

ğŸ”„ ç¬¬3æ¬¡å°è¯•: åˆ›å»ºæ–°ODCR (2å°)
ğŸ“Š è¿›åº¦: 0/10 (0.0%) | ODCRæ•°é‡: 0 | è¿è¡Œæ—¶é—´: 0:00:10
âœ… æ–°ODCRåˆ›å»ºæˆåŠŸ! cr-def456 (2 å°)
ğŸ“Š è¿›åº¦: 2/10 (20.0%) | ODCRæ•°é‡: 1 | è¿è¡Œæ—¶é—´: 0:00:11
â³ ç­‰å¾…30ç§’åç»§ç»­...

ğŸ”„ ç¬¬4æ¬¡å°è¯•: æ‰©å®¹ODCR cr-def456 +8å°
ğŸ“Š è¿›åº¦: 2/10 (20.0%) | ODCRæ•°é‡: 1 | è¿è¡Œæ—¶é—´: 0:00:41
âš ï¸  æ‰©å®¹å¤±è´¥ï¼Œå°è¯•åˆ›å»ºæ–°ODCR (8å°)
âš ï¸  å®¹é‡ä¸è¶³ï¼Œé™çº§åˆ° 4 å°é‡è¯•

ğŸ”„ ç¬¬5æ¬¡å°è¯•: åˆ›å»ºæ–°ODCR (4å°)
ğŸ“Š è¿›åº¦: 2/10 (20.0%) | ODCRæ•°é‡: 1 | è¿è¡Œæ—¶é—´: 0:00:46
âœ… æ–°ODCRåˆ›å»ºæˆåŠŸ! cr-ghi789 (4 å°)
ğŸ“Š è¿›åº¦: 6/10 (60.0%) | ODCRæ•°é‡: 2 | è¿è¡Œæ—¶é—´: 0:00:47
â³ ç­‰å¾…30ç§’åç»§ç»­...

ğŸ”„ ç¬¬6æ¬¡å°è¯•: æ‰©å®¹ODCR cr-ghi789 +4å°
ğŸ“Š è¿›åº¦: 6/10 (60.0%) | ODCRæ•°é‡: 2 | è¿è¡Œæ—¶é—´: 0:01:17
âœ… æ‰©å®¹æˆåŠŸ! ODCR cr-ghi789 ç°æœ‰ 8 å°
ğŸ“Š è¿›åº¦: 10/10 (100.0%) | ODCRæ•°é‡: 2 | è¿è¡Œæ—¶é—´: 0:01:18
============================================================
ğŸ‰ ä»»åŠ¡å®Œæˆ! ä½¿ç”¨ 2 ä¸ªODCRï¼Œæ€»è®¡ 10 å°å®ä¾‹
ğŸ“Š æ€»å°è¯•æ¬¡æ•°: 6

æœ€ç»ˆç»“æœ: ODCR-1(2å°) + ODCR-2(8å°) = 10å°
```

## å®æ—¶åŠŸèƒ½è¯´æ˜

### ğŸ“Š å®æ—¶çŠ¶æ€æ 
- **è¿›åº¦ç™¾åˆ†æ¯”**: å½“å‰å®Œæˆåº¦
- **ODCRæ•°é‡**: å·²åˆ›å»ºçš„ODCRä¸ªæ•°
- **è¿è¡Œæ—¶é—´**: ä»å¼€å§‹åˆ°ç°åœ¨çš„æ—¶é—´

### â±ï¸ å®šæœŸçŠ¶æ€æŠ¥å‘Š (æ¯30ç§’)
```
â±ï¸  è¿è¡ŒçŠ¶æ€æ›´æ–° (0:02:30):
   ğŸ“ˆ å½“å‰è¿›åº¦: 6/10 å°
   ğŸ”„ æ€»å°è¯•æ¬¡æ•°: 5
   ğŸ“‹ ODCRåˆ—è¡¨: 2
      1. cr-def456 (2å°)
      2. cr-ghi789 (4å°)
```

### â³ å€’è®¡æ—¶æ˜¾ç¤º
- **æˆåŠŸåç­‰å¾…**: 30ç§’å€’è®¡æ—¶
- **å®¹é‡ä¸è¶³ç­‰å¾…**: 30ç§’å€’è®¡æ—¶
- **å®æ—¶æ›´æ–°**: æ˜¾ç¤ºå‰©ä½™ç­‰å¾…æ—¶é—´

### âš ï¸ ä¸­æ–­å¤„ç†
- **Ctrl+C**: ä¼˜é›…ä¸­æ–­æ‰§è¡Œ
- **çŠ¶æ€ä¿å­˜**: æ˜¾ç¤ºå½“å‰è¿›åº¦
- **æ¸…ç†é€€å‡º**: ä¸ä¼šç•™ä¸‹æœªå®Œæˆçš„æ“ä½œ

## è¾“å‡ºæ ¼å¼

### æœ€ç»ˆç»“æœJSON
```json
{
  "success": true,
  "target_count": 10,
  "actual_count": 10,
  "created_odcrs": [
    {
      "odcr_id": "cr-def456",
      "initial_capacity": 2,
      "current_capacity": 2,
      "created_at": "20250923180000"
    },
    {
      "odcr_id": "cr-ghi789",
      "initial_capacity": 4,
      "current_capacity": 8,
      "created_at": "20250923180100"
    }
  ],
  "total_attempts": 6,
  "elapsed_time": "0:01:18",
  "completed": true
}
```

### å­—æ®µè¯´æ˜
- `success`: æ˜¯å¦æœ‰ä»»ä½•æˆåŠŸè´­ä¹°
- `target_count`: ç›®æ ‡å®ä¾‹æ•°é‡
- `actual_count`: å®é™…è·å¾—çš„å®ä¾‹æ•°é‡
- `created_odcrs`: åˆ›å»ºçš„ODCRåˆ—è¡¨
- `total_attempts`: æ€»å°è¯•æ¬¡æ•°
- `elapsed_time`: æ€»æ‰§è¡Œæ—¶é—´
- `completed`: æ˜¯å¦å®Œå…¨è¾¾åˆ°ç›®æ ‡

## æ ¸å¿ƒç®—æ³•

### æ™ºèƒ½æ‰©å®¹ä¼˜å…ˆçº§
1. **é¦–æ¬¡è´­ä¹°**: åˆ›å»ºæ–°ODCR
2. **åç»­è´­ä¹°**: ä¼˜å…ˆæ‰©å®¹æœ€åä¸€ä¸ªODCR
3. **æ‰©å®¹å¤±è´¥**: å°è¯•åˆ›å»ºæ–°ODCR
4. **ç›®æ ‡**: æœ€å°åŒ–ODCRæ•°é‡ï¼Œæœ€å¤§åŒ–èµ„æºåˆ©ç”¨

### æ‹†åˆ†è´­ä¹°ç­–ç•¥
1. **åˆå§‹å°è¯•**: ç›®æ ‡æ•°é‡
2. **å®¹é‡ä¸è¶³**: è‡ªåŠ¨å‡åŠ (10â†’5â†’2â†’1)
3. **æœ€å°å•ä½**: 1å°å®ä¾‹
4. **æŒç»­é‡è¯•**: ç›´åˆ°æˆåŠŸæˆ–è¶…æ—¶

### ç­‰å¾…ç­–ç•¥
- **æˆåŠŸåç­‰å¾…**: 30ç§’ (ç»™AWSæ—¶é—´é‡Šæ”¾/åˆ†é…å®¹é‡)
- **å®¹é‡ä¸è¶³ç­‰å¾…**: 30ç§’ (ç­‰å¾…å®¹é‡é‡Šæ”¾)
- **å¿«é€Ÿé‡è¯•**: 5ç§’ (é™çº§é‡è¯•)

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**1. æƒé™é”™è¯¯**
```
é”™è¯¯: AccessDenied
è§£å†³: æ£€æŸ¥AWSå‡­è¯å’ŒIAMæƒé™
```

**2. åŒºåŸŸé”™è¯¯**
```
é”™è¯¯: InvalidAvailabilityZone
è§£å†³: ç¡®è®¤å¯ç”¨åŒºåœ¨æŒ‡å®šåŒºåŸŸå†…å­˜åœ¨
```

**3. å®ä¾‹ç±»å‹é”™è¯¯**
```
é”™è¯¯: InvalidInstanceType
è§£å†³: ç¡®è®¤å®ä¾‹ç±»å‹åœ¨æŒ‡å®šåŒºåŸŸå¯ç”¨
```

**4. å®Œå…¨æ— å®¹é‡**
```
ç°è±¡: å³ä½¿1å°ä¹Ÿæ— æ³•è·å¾—å®¹é‡
è§£å†³: å°è¯•å…¶ä»–å¯ç”¨åŒºæˆ–å®ä¾‹ç±»å‹
```

### è°ƒè¯•æŠ€å·§

**1. ä½¿ç”¨è¾ƒå°çš„è¶…æ—¶æ—¶é—´æµ‹è¯•**
```bash
python odcr_manager.py create --instance-type t3.micro --availability-zone us-west-2a --count 2 --timeout 5
```

**2. æ£€æŸ¥AWSå‡­è¯**
```bash
aws sts get-caller-identity
```

**3. éªŒè¯åŒºåŸŸå’Œå¯ç”¨åŒº**
```bash
aws ec2 describe-availability-zones --region us-west-2
```

## æœ€ä½³å®è·µ

### 1. å®¹é‡è§„åˆ’
- åœ¨é«˜å³°æ—¶æ®µå‰æå‰é¢„ç•™
- è€ƒè™‘ä½¿ç”¨å¤šä¸ªå¯ç”¨åŒºåˆ†æ•£é£é™©
- ç›‘æ§å®¹é‡ä½¿ç”¨æƒ…å†µ

### 2. æˆæœ¬ä¼˜åŒ–
- ä½¿ç”¨åˆé€‚çš„å®ä¾‹ç±»å‹
- åŠæ—¶é‡Šæ”¾ä¸éœ€è¦çš„ODCR
- è€ƒè™‘ä½¿ç”¨Savings Plans

### 3. è¿ç»´å»ºè®®
- å®šæœŸæ£€æŸ¥ODCRçŠ¶æ€
- ç›‘æ§å®¹é‡åˆ©ç”¨ç‡
- å»ºç«‹å®¹é‡é¢„è­¦æœºåˆ¶

## é«˜çº§ç”¨æ³•

### 1. æ‰¹é‡è„šæœ¬
```bash
#!/bin/bash
# æ‰¹é‡åˆ›å»ºä¸åŒç±»å‹çš„ODCR

python odcr_manager.py create --instance-type m5.large --availability-zone us-west-2a --count 10
python odcr_manager.py create --instance-type c5.xlarge --availability-zone us-west-2b --count 5
python odcr_manager.py create --instance-type r5.large --availability-zone us-west-2c --count 8
```

### 2. ç»“æœå¤„ç†
```bash
# ä¿å­˜ç»“æœåˆ°æ–‡ä»¶
python odcr_manager.py create --instance-type m5.large --availability-zone us-west-2a --count 10 > result.log 2>&1

# æå–ODCR ID
python odcr_manager.py create --instance-type m5.large --availability-zone us-west-2a --count 10 | grep "cr-" | awk '{print $4}'
```

### 3. ç›‘æ§é›†æˆ
```python
# ç¤ºä¾‹: é›†æˆåˆ°ç›‘æ§ç³»ç»Ÿ
import subprocess
import json

result = subprocess.run(['python', 'odcr_manager.py', 'create', '--instance-type', 'm5.large', '--availability-zone', 'us-west-2a', '--count', '10'], 
                       capture_output=True, text=True)

if result.returncode == 0:
    # è§£æJSONç»“æœå¹¶å‘é€åˆ°ç›‘æ§ç³»ç»Ÿ
    output_lines = result.stdout.strip().split('\n')
    json_result = json.loads(output_lines[-1])
    # å‘é€åˆ°ç›‘æ§ç³»ç»Ÿ...
```
